#
# Experimental container portal configuration
#
# - Based upon /etc/apache2/ucs-sites.conf.d/univention-portal.conf
# - Generated by ansible
#
# Makes the portal in the container available, so that it can be tested out.
#


# TODO: Handling of icons
#
# For now rewriting these to the old scheme, so that they are
# reachable. These items cannot be in the frontend container and need
# a dedicated solution.
RewriteRule "^/{{ url_prefix }}/portal{{ url_suffix }}/(icons/.*)$" "/univention/portal/$1"


# Sub-paths which have to go into the backend container
ProxyPassMatch "^/{{ url_prefix }}/portal{{ url_suffix }}/(portal.json)$" "http://127.0.0.1:{{ ports.portal_server }}/univention/portal/$1" retry=0

# Everything else goes into the frontend container
ProxyPassMatch "^/{{ url_prefix }}/portal{{ url_suffix }}/(.*)$" "http://127.0.0.1:{{ ports.portal_frontend }}/$1" retry=0



# TODO: Redirect to frontend container
<Directory /var/www/univention/portal/>
        <FilesMatch "(portal|apps)\.json|portal\.css">
                Header set Cache-Control "max-age=0, must-revalidate"
        </FilesMatch>
</Directory>
<Directory /var/www/univention/portal/>
        Header set Cache-Control "max-age=0, must-revalidate"
</Directory>


# TODO: UMC? Double check if we really want this
ProxyPassMatch /({{ url_prefix }}/umc/.*) http://127.0.0.1:{{ ports.portal_server }}/$1 retry=0

<Directory /var/www/univention/umc/>
        <FilesMatch "(portal|apps)\.json|portal\.css">
                Header set Cache-Control "max-age=0, must-revalidate"
        </FilesMatch>
</Directory>
<Directory /var/www/univention/umc/>
        Header set Cache-Control "max-age=0, must-revalidate"
</Directory>
