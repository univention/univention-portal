#
# Experimental container portal configuration
#
# - Based upon /etc/apache2/ucs-sites.conf.d/univention-portal.conf
# - Generated by ansible
#
# Makes the portal in the container available, so that it can be tested out.
#

# Redirect base to portal
#
# Compare: /etc/apache2/conf-enabled/univention-web.conf
#
# TODO: Should have tests which check that this does in fact work in k8s and in
# app-center.

<LocationMatch "^/univention-container/$">
  Redirect temp /univention-container/ /univention-container/portal/
</LocationMatch>


ProxyPassMatch /({{ url_prefix }}/portal/.*) http://127.0.0.1:{{ ports.portal_server }}/$1 retry=0

# TODO: Redirect to frontend container
<Directory /var/www/univention/portal/>
        <FilesMatch "(portal|apps)\.json|portal\.css">
                Header set Cache-Control "max-age=0, must-revalidate"
        </FilesMatch>
</Directory>
<Directory /var/www/univention/portal/>
        Header set Cache-Control "max-age=0, must-revalidate"
</Directory>


# TODO: UMC? Double check if we really want this
ProxyPassMatch /({{ url_prefix }}/umc/.*) http://127.0.0.1:{{ ports.portal_server }}/$1 retry=0

<Directory /var/www/univention/umc/>
        <FilesMatch "(portal|apps)\.json|portal\.css">
                Header set Cache-Control "max-age=0, must-revalidate"
        </FilesMatch>
</Directory>
<Directory /var/www/univention/umc/>
        Header set Cache-Control "max-age=0, must-revalidate"
</Directory>
