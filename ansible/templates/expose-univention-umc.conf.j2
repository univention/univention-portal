#
# Expose UMC endpoints to the containerized portal-server
#
# - Overwrites part of the logic of
#   /etc/apache2/sites-enabled/univention.conf
# - Generated by ansible
#
# It "fakes" the client IP to  always be the same to circumvent the security
# checks of UMC's webserver.
#
# The exposed endpoint is protected by Basic auth.
#
# See docs/decisions/0007-basic-auth-with-umc.md for more information.
#

<LocationMatch "^/univention/get/(categories|modules|session-info)/?$">
    ProxyAddHeaders Off

    # Guard the endpoints by basic auth with a shared secret
    AuthType Basic
    AuthName "UMC Internal"
    AuthUserFile /etc/apache2/portal_auth.passwd
    Require valid-user

    # Remove the Authorization header, to avoid confusing the UMC
    RequestHeader unset authorization

    # Pretend that anyone passing the authorization is from the local machine
    # to satisfy the origin check of the UMC's webserver.
    RequestHeader set X-Forwarded-For 127.0.0.1
</LocationMatch>
