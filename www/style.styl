/*
 * Copyright 2017-2020 Univention GmbH
 *
 * https://www.univention.de/
 *
 * All rights reserved.
 *
 * The source code of this program is made available
 * under the terms of the GNU Affero General Public License version 3
 * (GNU AGPL V3) as published by the Free Software Foundation.
 *
 * Binary versions of this program provided by Univention to you as
 * well as other copyrighted, protected or trademarked materials like
 * Logos, graphics, fonts, specific documentations and configurations,
 * cryptographic keys etc. are subject to a license agreement between
 * you and Univention and not subject to the GNU AGPL V3.
 *
 * In the case you use this program under the terms of the GNU AGPL V3,
 * the program is provided in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public
 * License with the Debian GNU/Linux or Univention distribution in file
 * /usr/share/common-licenses/AGPL-3; if not, see
 * <https://www.gnu.org/licenses/>.
 */

@require "icons.styl"
@require "widgets.styl"
@require "Dialog.styl"
@require "render.styl"
@require "menu.styl"
@require "dnd.styl"
@require "AddCategoryButton.styl"
@require "_PortalIframe.styl"



////// portal style (style.styl)
:root
	--portal-header-height: var(--layout-height-header)

.portal
	--portal-header-to-content-seperator-height: var(--layout-spacing-unit-small)
	min-height: 100vh

body.scrollLess
	overflow: hidden

@css {
	.overlaybg {
		background: rgba(var(--color-grey8-rgb), 0.8);
		backdrop-filter: blur(8px)
	}
}


//// portal header
.portal__header
	position: fixed
	top: 0
	left: 0
	right: 0
	z-index: 1
	background-color: var(--bgc-content-header)
	color: var(--font-color-contrast-high)
	height: var(--portal-header-height)
	display: flex
	// padding: 0 var(--layout-margin)
	padding: 0 calc(2 * var(--layout-spacing-unit))

.portal__header__left
	flex: 0 0 auto
	display: flex
	align-items: center
	cursor: pointer

	img
		width: calc(6 * var(--layout-spacing-unit-small))
		margin-right: calc(3 * var(--layout-spacing-unit-small))

	h2 // TODO have margin 0 as general style?
		margin: 0

.portal__header__stretch
	flex: 1 1 auto

.portal__header__right
	display: flex
	align-items: center

.portal__header__right .dijitToggleButton
	margin: 0 var(--layout-spacing-unit-small)

.portal__header__right,
.portal__header__editMode
	.ucsIconButton
		--font-size-button-icon: var(--font-size-big)

//// portal header end


.portal__categories
	position: relative
	top: var(--portal-header-height)
	padding: calc(7 * var(--layout-spacing-unit)) calc(6 * var(--layout-spacing-unit))

.portal__category
	cursor: default // this is for the dnd in edit mode
	margin-bottom: calc(10 * var(--layout-spacing-unit))

	&:last-child
		margin-bottom: 0

.portal__category__tiles
	display: grid
	grid-template-columns: repeat(auto-fill, var(--app-tile-side-length))
	grid-gap: calc(6 * var(--layout-spacing-unit))


.portal__category__title
	margin-bottom: calc(6 * var(--layout-spacing-unit))

	&--edit
		cursor: pointer
		display: inline-flex
		align-items: center

.editMark
	width: 2em
	height: 2em
	background-color: var(--color-grey0)
	background-size: 1em
	background-repeat: no-repeat
	background-position: center
	border-radius: 50%
	box-shadow: var(--box-shadow)

.portal__category__title__editMark
	margin-right: 1em

.tileLink,
.tileLink:hover
	color: var(--font-color-contrast-high)
	text-decoration: none

.tileLink
	position: relative
	outline: 0 

.tile
	position: relative
	width: var(--app-tile-side-length)
	display: flex
	flex-direction: column
	align-items: center
	cursor: pointer

$tile__box
	border-radius: 15%
	display: flex
	align-items: center
	justify-content: center
	box-shadow: var(--box-shadow)
	background: var(--color-grey40)

.tile__box,
.tile__box--thumbnail,
.tile__box--thumbnail--folder
	@extends $tile__box

.tile__box
	width: var(--app-tile-side-length)
	height: @width
	margin-bottom: calc(2 * var(--layout-spacing-unit))

.tile__dotted
	width: calc(20 * var(--layout-spacing-unit))
	height: @width
	border-radius: 15%
	border: 3px dashed var(--color-grey40) !important
	// opacity: 0.4

.tile__add
	margin: 0
	width: var(--app-tile-side-length)
	height: @width
	border-radius: 15%
	border: 3px solid var(--color-grey40)
	background-color: transparent
	background-image: url(icons/plus_grey.svg)
	background-position: center
	background-size: 3em
	background-repeat: no-repeat
	// opacity: 0.4
	cursor: pointer

	.dijitButtonNode
		width: 100%
		height: 100%
	.dijitButtonContents
		outline: 0

.tile__logo
	width: 80%

.tile__name
	text-align: center
	width: 100%
	overflow: hidden
	text-overflow: ellipsis
	white-space: nowrap // TODO not sure

.tile__editMark
	position: absolute
	top: -0.75em
	right: @top

.tile__thumbnails
	width: 80%
	height: @width
	display: grid
	grid-template-columns: repeat(3, 1fr)
	grid-template-rows: repeat(3, 1fr)
	grid-gap: 8px

.tile__box--thumbnail--folder
	background: var(--color-grey62)

.tile__box--folder
	background: s('rgba(var(--color-grey0-rgb), 0.7)')

$appDescriptionPadding = calc(2 * var(--layout-spacing-unit))
.appDescription
	font-size: var(--font-size-small)
	position: fixed
	bottom: $appDescriptionPadding
	right: @bottom
	background-color: var(--color-grey0)
	border-radius: 16px
	max-width: calc(40 * var(--layout-spacing-unit))
	padding: $appDescriptionPadding
	box-shadow: var(--box-shadow)
	pointer-events: none

.appDescription__header
	display: flex
	align-items: center
	margin-bottom: $appDescriptionPadding

	.tile__box--thumbnail
		width: calc(3 * var(--layout-spacing-unit))
		height: @width
		margin-right: calc(3 * var(--layout-spacing-unit-small))


// folder
.portal__folder
	position: fixed
	top: var(--portal-header-height)
	right: 0
	bottom: 0
	left: 0

.portal__folder__overlay
	width: 100%
	height: 100%

.portal__folder__wrapper
	display: flex
	flex-direction: column
	align-items: center
	margin: auto
	width: 85%
	max-width: 720px
	height: 100%
	position: relative

	.ucsIconButton
		position: absolute
		top: calc(10 * var(--layout-spacing-unit))
		right: -32px

.box
	width: 720px
	height: @width
	border-radius: 10%
	margin: calc(10 * var(--layout-spacing-unit)) 0 calc(3 * var(--layout-spacing-unit))
	overflow: hidden
	position: relative

@css {
	.box {
		background: rgba(var(--color-grey0-rgb), 0.7);
	}
}

.carrousell
	display: flex
	position: relative
	transition: left 0.3s
	left: 0

.slide
	width: 720px // TODO duplicated
	height: @width
	display: grid
	grid-template-columns: repeat(3, 1fr)
	grid-template-rows: repeat(3, 1fr)
	align-items: center
	justify-items: center
	padding: calc(4 * var(--layout-spacing-unit))
	flex: 0 0 auto

.nav
	position: absolute
	bottom: 0
	width: 100%
	display: flex
	align-items: center
	justify-content: center

	.bubble
		cursor: pointer
		width: 16px
		height: 16px
		margin: 8px
		border-radius: 100%
		background: grey

		&--active
			background: white

// iframe tabs
.portal__iframeTabs
	display: flex
	flex: 1 1 auto
	margin-left: calc(5 * var(--layout-spacing-unit))

	.iframeTab
		--tabColor: transparent
		outline: 0
		cursor: pointer
		display: flex
		align-items: center
		min-width: calc(30 * var(--layout-spacing-unit))
		position: relative

		&:after
			content: ''
			display: block
			// height: var(--font-size-big)
			height: calc(3 * var(--layout-spacing-unit))
			width: 2px
			background: var(--color-grey8)
			position: relative
			right: -1px
			margin-left: var(--layout-spacing-unit-small)
			z-index: -2

	.iframeTabHover,
	.iframeTabFocused
		--tabColor: #272726
		z-index: 1
	.iframeTabSelected
		--tabColor: var(--color-grey8)
		z-index: 2

	$iframeTabColorTransitionTime = 250ms
	.iframeTab__background
		transition: background-color $iframeTabColorTransitionTime
		position: absolute
		top: 10px
		right: -1px
		bottom: 0
		left: -1px
		border-radius: 8px 8px 0 0
		background-color: var(--tabColor)
		z-index: -1

		&:before,
		&:after
			content: ''
			display: block
			position: absolute
			bottom: 0
			height: 8px
			width: 16px
			transition: box-shadow $iframeTabColorTransitionTime
		&:before
			left: -16px
			border-radius: 0 0 8px 0
		&:after
			right: -16px
			border-radius: 0 0 0 8px
		&:before
			box-shadow: 8px 0 0 0 var(--tabColor)
		&:after
			box-shadow: -8px 0 0 0 var(--tabColor)

	.iframeTab__logo
		width: 1em
		margin: 0 0.5em

	.iframeTab__title
		flex: 1 1 auto
		width: 20ch
		overflow: hidden
		text-overflow: ellipsis
		white-space: nowrap

	.iframeTab__closeButton
		--button-icon-length: 1.3em
		margin-left: 0.5em

.portal__mobileIframeTabs
	overflow: auto
	position: fixed
	top: var(--portal-header-height)
	right: 0
	bottom: 0
	left: 0
	display: flex
	flex-direction: column
	align-items: center
	flex: 1 1 auto
	padding-top: calc(5 * var(--layout-spacing-unit))

	.iframeTab
		flex: 0 0 auto
		outline: 0
		cursor: pointer
		display: flex
		align-items: center
		height: calc(7 * var(--layout-spacing-unit))
		width: 90%
		max-width: calc(50 * var(--layout-spacing-unit))
		border-radius: 16px
		background: var(--color-grey0)
		margin-bottom: calc(3 * var(--layout-spacing-unit))

	.iframeTab__background
		display: none

	.iframeTab__logo
		width: calc(3 * var(--layout-spacing-unit))
		margin-right: calc(3 * var(--layout-spacing-unit-small))
		margin-left: calc(3 * var(--layout-spacing-unit))

	.iframeTab__title
		flex: 1 1 auto

	.iframeTab__closeButton
		font-size: var(--font-size-small)
		margin-left: calc(3 * var(--layout-spacing-unit-small))
		margin-right: calc(2 * var(--layout-spacing-unit))

.portal__mobileIframeTabsButton
	position: relative

	.portal__mobileIframeTabsButton__counter
		pointer-events: none
		display: block
		font-size: 12px
		position: absolute
		top: 15px
		left: 19px

	&.dijitChecked .portal__mobileIframeTabsButton__counter
		color: var(--color-primary)

// iframe tabs end


// iframes
.portal__iframes
	position: fixed
	top: var(--portal-header-height)
	border: 0px solid var(--color-grey8) // TODO var for selected tab color
	border-top-width: var(--portal-header-to-content-seperator-height)
	right: 0
	bottom: 0
	left: 0
	background-color: white
	// z-index: 27 // TODO
// iframes end


// search
.portal__search
	width: 95%
	max-width: calc(40 * var(--layout-spacing-unit))
	position: fixed
	top: "calc(%s + %s)" % (var(--portal-header-height) var(--portal-header-to-content-seperator-height))
	transition: right 250ms
	right: -@width

	&--open
		right: 0

.portalSearchBox
	background-color: var(--color-grey0)
// search end


// background
.portal__background
	position: fixed
	top: var(--portal-header-height)
	left: 0
	right: 0
	bottom: 0
	background-position: top center
	background-size: cover
	background-repeat: no-repeat
// background end


// login iframe
.portal__loginIframeWrapper
	position: fixed
	top: var(--portal-header-height)
	left: 0
	right: 0
	bottom: 0
// login iframe end


// notifications
.ucsNotifications
	overflow: auto
	position: fixed
	top: var(--portal-header-height)
	bottom: 0
	right: 0
	width: 80%
	max-width: 360px
	border: 0px solid var(--color-grey8)
	border-top-width: var(--layout-spacing-unit-small)
	background-color: var(--color-grey0)
	transition: transform cubic-bezier(0.4, 0, 0.6, 1) 0.15s
	z-index: 30
	transform: translate3d(110%, 0, 0)
	padding: 0 calc(2 * var(--layout-spacing-unit))
	display: flex
	flex-direction: column

	&--open
		transform: translate3d(0, 0, 0)

.ucsNotifications__title
	margin: calc(2 * var(--layout-spacing-unit)) 0

$ucsNotificationBorderRadius = 12px
$ucsNotificationBgc = #121211 // TODO FIXME where is this color coming from
.ucsNotification
	background: $ucsNotificationBgc
	border-radius: $ucsNotificationBorderRadius
	padding: 16px
	font-size: var(--font-size-small)
	margin-bottom: 16px

.ucsNotification__header
	display: flex
	align-items: center
	margin-bottom: 8px

.ucsNotification__logoWrapper
	flex: 0 0 auto
	width: 16px
	height: 16px
	border-radius: 2px
	background: var(--color-grey25)
	margin-right: 8px

.ucsNotification__title
	flex: 1 1 auto

.ucsNotification__closeButton
	flex: 0 0 auto
	font-size: var(--font-size-small)

.ucsNotificationPreview
	position: fixed
	top: calc(var(--portal-header-height) + 16px)
	right: var(--layout-spacing-unit)
	width: 90vw
	max-width: 300px
	opacity: 0
	transition: opacity 0ms

	.ucsNotification
		position: relative
		background: transparent
		margin: 0

	&--open
		opacity: 1

.ucsNotificationPreview__background--drained
	position: absolute
	top: 0
	left: 0
	bottom: 0
	right: 0
	overflow: hidden
	border-radius: $ucsNotificationBorderRadius
	background: var(--color-grey25)

.ucsNotificationPreview__background--full
	height: 100%
	width: 100%
	border-radius: $ucsNotificationBorderRadius 0 0 $ucsNotificationBorderRadius
	background: $ucsNotificationBgc
	transition: width 0ms linear

	&.drained
		// width: 0 // no drain styling for now
		width: 100%

.ucsNotificationPreview__triangle
	position: absolute
	top: -12px
	right: 72px
	width: 0
	height: 0
	border-left: 8px solid transparent
	border-right: 8px solid transparent
	border-bottom: 12px solid $ucsNotificationBgc
// notifications end


// edit mode
.portal__header__editMode
	display: flex
	align-items: center

.editMode
	.portal__iframeTabs,
	.portal__header__right,
	.portal__search,
	.portal__iframes,
	.portal__loginIframeWrapper,
	.portal__mobileIframeTabs,
	.ucsNotificationPreview,
	.ucsNotifications,
	.mobileMenuCloseOverlay,
	.mobileMenu
		display: none

body:not(.editMode)
	.portal__header__editMode,
	.portalProperties
		display: none


.portal__header__editMode__text
	margin-right: 16px

.portalProperties__title
	margin-top: calc(2 * var(--layout-spacing-unit))

.portalProperties
	overflow: auto
	position: fixed
	top: var(--portal-header-height)
	bottom: 0
	right: 0
	width: 80%
	max-width: 360px
	border: 0px solid var(--color-grey8)
	border-top-width: var(--layout-spacing-unit-small)
	background-color: var(--color-grey0)
	transition: transform cubic-bezier(0.4, 0, 0.6, 1) 0.15s
	z-index: 30
	transform: translate3d(110%, 0, 0)

	&--open
		transform: translate3d(0, 0, 0)

.portalProperties__saveButtonWrapper
	position: sticky
	bottom: 0
	width: 100%
	background-color: var(--color-grey0)
	padding: 1em

.portalProperties__title,
.portalProperties__form
	padding: 0 1em
// edit mode end

.umcMultiInput--staticSize
	.umcMultiInputAddButton,
	.umcMultiInputRemoveButton
		display: none


.umcLabelPane-umcMultiInput
	width: 100%

// .umcMultiInputContainer
	// display: flex

.umcMultiInputRemoveButton
	padding: 0.5em


#portalLoading
	position: fixed
	top: 50%
	left: 50%
